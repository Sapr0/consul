# generated by chef for <%= @name %>

description "<%= @name %> agent"

start on runlevel [2345]
stop on runlevel [!2345]

<%= "limit nofile #{node['consul']['service_nofile']}" if node['consul']['service_nofile'] %>

respawn
respawn limit 10 5
umask 022
chdir <%= @data_dir %>
<%- @environment.each do |key, val| -%>
env <%= key %>="<%= val %>"
<%- end -%>
setuid <%= @user %>
kill signal SIGINT
reload signal HUP

exec <%= @program %> agent -config-file=<%= @config_file %> -config-dir <%= @config_dir %>

pre-stop script
  PID=`initctl status <%= @name %> | sed 's/^.*process \([0-9]*\)$/\1/'`
  if [ -n "$PID" ]; then
    kill -SIGINT "$PID"
  fi
end script
