[Unit]
Description=<%= @name %>
Wants=network.target
After=network.target

[Service]
Environment=<%= @environment.map {|key, val| %Q{"#{key}=#{val}"} }.join(' ') %>
ExecStart=<%= @program %> agent -config-file=<%= @config_file %> -config-dir <%= @config_dir %>
ExecReload=/bin/kill -HUP $MAINPID
KillSignal=SIGINT
User=<%= @user %>
WorkingDirectory=<%= @data_dir %>
<%= "LimitNOFILE=#{node['consul']['service_nofile']}" if node['consul']['service_nofile'] %>
Restart=on-failure
RestartSec=30s

[Install]
WantedBy=multi-user.target
